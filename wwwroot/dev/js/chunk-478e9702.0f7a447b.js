(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-478e9702"],{dbf6:function(e,t,n){"use strict";var i=n("f81c"),r=n.n(i);r.a},f1b0:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%"}},[n("div",{staticClass:"header"},[n("el-radio-group",{staticStyle:{"margin-left":"40px"},attrs:{fill:"#0994ff",size:"small"},model:{value:e.activeView,callback:function(t){e.activeView=t},expression:"activeView"}},e._l(e.views,(function(t){return n("el-radio-button",{key:t.label,attrs:{label:t.label}},[e._v(e._s(t.title))])})),1),e._v(" "),n("el-dropdown",{on:{command:e.onTableCommand}},[n("el-button",{attrs:{size:"small",icon:"fas fa-table"}},[e._v(" Insert"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"ICL"}},[e._v("Column Left")]),n("el-dropdown-item",{attrs:{command:"ICR"}},[e._v("Column Right")]),n("el-dropdown-item",{attrs:{command:"IRA",divided:""}},[e._v("Row Above")]),n("el-dropdown-item",{attrs:{command:"IRB"}},[e._v("Row Below")])],1)],1),n("el-dropdown",{on:{command:e.onTableCommand}},[n("el-button",{attrs:{size:"small",icon:"fas fa-table"}},[e._v(" Delete"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"DC"}},[e._v("Column")]),n("el-dropdown-item",{attrs:{command:"DR"}},[e._v("Row")])],1)],1),n("el-dropdown",{on:{command:e.onTableCommand}},[n("el-button",{attrs:{size:"small",icon:"fas fa-table"}},[e._v(" Cells"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"CM"}},[e._v("Merge")]),n("el-dropdown-item",{attrs:{command:"CS"}},[e._v("Split")])],1)],1),n("el-button",{attrs:{size:"small",icon:"fas fa-times fa-fw"},on:{click:e.onDeleteSelection}},[e._v("Delete Selection")])],1),n("div",{staticClass:"content"},[n("design-view",{ref:"designView",attrs:{background:"lightgray"},on:{ready:e.onDesignViewReady}})],1)])},r=[],o=n("c34c"),a=(n("ac4d"),n("8a81"),n("ac6a"),n("d225")),s=n("b0b4"),l=n("2de8"),c=n("308d"),d=n("6bb5"),u=n("4e2b"),h=n("ffb8"),g=n("a374"),f=n("fe0c"),m=n("1fb1"),v=function(e){function t(){var e;return Object(a["a"])(this,t),e=Object(c["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.anchorSize=6,e.anchorLocation=m["a"].None,e}return Object(u["a"])(t,e),Object(s["a"])(t,[{key:"OnRender",value:function(e){e.strokeStyle="darkgray",e.lineWidth=2,e.strokeRect(-3,-3,this.Target.Bounds.Width+6,this.Target.Bounds.Height+6),this.DrawAnchor(e,this.BottomCenter)}},{key:"DrawAnchor",value:function(e,t){e.fillStyle="white",e.fillRect(t.X,t.Y,t.Width,t.Height),e.strokeStyle="black",e.lineWidth=1,e.strokeRect(t.X,t.Y,t.Width,t.Height)}},{key:"HitTest",value:function(e){var t="";return this.BottomCenter.Contains(e.X,e.Y)?(this.anchorLocation=m["a"].BottomCenter,t="s-resize"):this.anchorLocation=m["a"].None,this.anchorLocation!=m["a"].None?[!0,t]:[!1,t]}},{key:"OnMouseMove",value:function(e){this.Target.Resize(this.anchorLocation,e.DeltaX,e.DeltaY)}},{key:"OnMouseUp",value:function(e){this.Target.OnEndResize()}},{key:"BottomCenter",get:function(){return new g["a"]((this.Target.Bounds.Width-this.anchorSize)/2,this.Target.Bounds.Height,this.anchorSize,this.anchorSize)}}]),t}(f["a"]),y=n("b7c5"),S=n("8500"),b=n("a2ee"),w=n("26e6"),p=function(e){function t(e,n,i){var r;Object(a["a"])(this,t),r=Object(c["a"])(this,Object(d["a"])(t).call(this,e)),r._bounds=new g["a"](0,0,0,0);var o=b["a"].TryGetSize(r.xmlNode,"Height",200);r._bounds=new g["a"](0,i,n,o);var s=b["a"].GetNamedChildNode(r.xmlNode,"ReportItems");if(s){var l=!0,u=!1,h=void 0;try{for(var f,m=s.childNodes[Symbol.iterator]();!(l=(f=m.next()).done);l=!0){var v=f.value;if(v.nodeType===Node.ELEMENT_NODE){var y=w["a"].Make(v,null);y&&r.AddItem(y)}}}catch(S){u=!0,h=S}finally{try{l||null==m.return||m.return()}finally{if(u)throw h}}}return r}return Object(u["a"])(t,e),Object(s["a"])(t,[{key:"SetBounds",value:function(e,t,n,i,r){if(r===y["a"].Height){var o=i-this._bounds.Height;if(this.Parent){this._bounds.Height=i;for(var a=-1,s=0;s<this.Parent.Items.length;s++){var l=this.Parent.Items[s];-1===a&&l===this&&(a=s),-1!==a&&s>a&&(l.Bounds.Y+=o)}this.Parent.Bounds.Height+=o}this.Surface&&this.Surface.Invalidate()}else console.warn("ReportSectionDesigner只支持设置高度值")}},{key:"OnEndResize",value:function(){this.SetPropertyRSize("Height",this.Bounds.Height),this.Surface&&this.Surface.PropertyPanel.refreshProperty("Height")}},{key:"Paint",value:function(e){if(e.save(),e.beginPath(),e.rect(this.Bounds.X,this.Bounds.Y,this.Bounds.Width,this.Bounds.Height),e.clip(),e.fillStyle="white",e.fillRect(this.Bounds.X,this.Bounds.Y,this.Bounds.Width,this.Bounds.Height),e.strokeStyle="rgb(173,219,241)",e.lineWidth=1,e.strokeRect(this.Bounds.X,this.Bounds.Y,this.Bounds.Width,this.Bounds.Height),this.Items){e.translate(this.Bounds.X,this.Bounds.Y);var t=!0,n=!1,i=void 0;try{for(var r,o=this.Items[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.Paint(e)}}catch(s){n=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}e.translate(-this.Bounds.X,-this.Bounds.Y)}e.restore()}},{key:"getPropertyItems",value:function(){var e=this,t=[{name:"Common",items:[{title:"Height",readonly:!1,editor:"TextBox",getter:function(){return e.GetPropertyRSize("Height","0mm")},setter:function(t){return e.SetPropertyRSize("Height",t)}}]}];return"Body"!==this.getPropertyOwnerType()&&(t[0].items.push({title:"PrintOnFirstPage",readonly:!1,editor:"CheckBox",getter:function(){return e.GetPropertyBool("PrintOnFirstPage",!0)},setter:function(t){return e.SetPropertyBool("PrintOnFirstPage",t)}}),t[0].items.push({title:"PrintOnLastPage",readonly:!1,editor:"CheckBox",getter:function(){return e.GetPropertyBool("PrintOnLastPage",!0)},setter:function(t){return e.SetPropertyBool("PrintOnLastPage",t)}})),t}},{key:"Bounds",get:function(){return this._bounds},set:function(e){this.SetBounds(e.X,e.Y,e.Width,e.Height,y["a"].All)}},{key:"IsContainer",get:function(){return!0}},{key:"Behavior",get:function(){return S["a"].CanResize}},{key:"SelectionAdorner",get:function(){return!this._selectionAdorner&&this.Surface&&(this._selectionAdorner=new v(this.Surface.Adorners,this)),this._selectionAdorner}}]),t}(h["a"]),P=function(e){function t(e){var n;Object(a["a"])(this,t),n=Object(c["a"])(this,Object(d["a"])(t).call(this,e)),n._bounds=new g["a"](0,0,0,0);var i=0,r=b["a"].TryGetSize(n.xmlNode,"PageWidth",400),o=b["a"].GetNamedChildNode(n.xmlNode,"PageHeader");if(o){var s=new p(o,r,i);n.AddItem(s),i+=s.Bounds.Height}var l=b["a"].GetNamedChildNode(n.xmlNode,"Body");if(l){var u=new p(l,r,i);n.AddItem(u),i+=u.Bounds.Height}var h=b["a"].GetNamedChildNode(n.xmlNode,"PageFooter");if(h){var f=new p(h,r,i);n.AddItem(f),i+=f.Bounds.Height}return n._bounds=new g["a"](8,8,r,i),n}return Object(u["a"])(t,e),Object(s["a"])(t,[{key:"SetBounds",value:function(e,t,n,i,r){}},{key:"Paint",value:function(e){if(this.Items){var t=!0,n=!1,i=void 0;try{for(var r,o=this.Items[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.Paint(e)}}catch(s){n=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}}},{key:"OnChangePageWidth",value:function(e){this._bounds.Width=b["a"].SizeToPixel(e);var t=!0,n=!1,i=void 0;try{for(var r,o=this.Items[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.Bounds.Width=this._bounds.Width}}catch(s){n=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}this.Surface.Invalidate()}},{key:"OnChangePageHeight",value:function(e){}},{key:"getPropertyItems",value:function(){var e=this,t=[{name:"Common",items:[{title:"PageWidth",readonly:!1,editor:"TextBox",getter:function(){return e.GetPropertyRSize("PageWidth","200mm")},setter:function(t){e.SetPropertyRSize("PageWidth",t),e.OnChangePageWidth(t)}},{title:"PageHeight",readonly:!1,editor:"TextBox",getter:function(){return e.GetPropertyRSize("PageHeight","150mm")},setter:function(t){e.SetPropertyRSize("PageHeight",t),e.OnChangePageHeight(t)}}]}];return t}},{key:"Bounds",get:function(){return this._bounds},set:function(e){}},{key:"IsContainer",get:function(){return!0}}]),t}(h["a"]),C=function(){function e(t,n,i){Object(a["a"])(this,e),this._surface=t,this._channel=n,this._modelId=i,this._surface.DesignService=this}return Object(s["a"])(e,[{key:"SetToolbox",value:function(e){this._surface.ToolboxService.Toolbox=e}},{key:"GetXmlString",value:function(){var e=this._rootDesigner.XmlNode.ownerDocument;return(new XMLSerializer).serializeToString(e)}},{key:"LoadDesigners",value:function(e){var t=b["a"].LoadXMLString(e),n=t.getElementsByTagName("Report")[0],i=new P(n);this._rootDesigner=i,this._surface.AddItem(this._rootDesigner),this._surface.PropertyPanel.setPropertyOwner(this._rootDesigner),this._surface.Invalidate()}},{key:"ChangeProperty",value:function(e,t,n,i){console.log("ReportDesignService.ChangeProperty: "+t,i)}},{key:"DeleteSelection",value:function(){var e=this._surface.SelectionService.SelectedItems;if(e&&0!==e.length){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a instanceof l["a"]&&!a.IsTableCell&&(a.Parent?a.Parent.RemoveItem(a):console.warn("待删除的元素无上级"))}}catch(s){n=!0,i=s}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}this._surface.SelectionService.ClearSelection()}}},{key:"InsertColumn",value:function(e){var t=this._surface.SelectionService.SelectedItems;if(0===t.length||!(t[0]instanceof l["a"])||!t[0].IsTableCell)return"Please select some TableCell first.";var n=t[0],i=n.Cell.Row,r=n.Cell.ColIndex;e||r++,i.Owner.Table.InsertColumn(r,100),i.Owner.Table.Parent.Invalidate()}},{key:"DeleteColumn",value:function(){var e=this._surface.SelectionService.SelectedItems;if(0===e.length||!(e[0]instanceof l["a"])||!e[0].IsTableCell)return"Please select some TableCell first.";var t=e[0],n=t.Cell.Row.Owner.Table;if(1===n.Columns.length)return"Cann't delete last column.";var i=t.Cell.ColIndex;t.Cell.Row.Owner.Table.DeleteColumn(i),n.Parent.Invalidate()}},{key:"GetShapes",value:function(){return[]}},{key:"GetConnections",value:function(){return[]}},{key:"Surface",get:function(){return this._surface}},{key:"RootDesigner",get:function(){return this._rootDesigner}}]),e}(),k=n("8cde"),B={components:{DesignView:o["a"]},props:{target:{type:Object,required:!0}},data:function(){return{activeView:"design",views:[{label:"design",title:"Design"},{label:"preview",title:"Preview"}],designerType:"ReportDesigner",designService:null}},methods:{onDesignViewReady:function(){if(this.designService=new C(this.$refs.designView.designSurface,$runtime.channel,this.target.ID),this.designService.SetToolbox(new k["a"]),0===this.target.ID){var e="<Report>";return e+="<PageWidth>200mm</PageWidth>",e+="<PageHeight>140mm</PageHeight>",e+="<PageHeader>",e+="<Height>20mm</Height>",e+="<ReportItems>",e+='<Textbox Name="Textbox1">',e+="<Left>50pt</Left>",e+="<Top>10pt</Top>",e+="<Width>100pt</Width>",e+="<Height>30pt</Height>",e+="<Value>测试报表 Hello Future! 1234567890</Value>",e+="</Textbox>",e+="</ReportItems>",e+="</PageHeader>",e+="<Body>",e+="<Height>40mm</Height>",e+="</Body>",e+="<PageFooter>",e+="<Height>15mm</Height>",e+="</PageFooter>",e+="</Report>",void this.designService.LoadDesigners(e)}var t=this;$runtime.channel.invoke("sys.DesignService.OpenReportModel",[this.target.ID]).then((function(e){t.designService.LoadDesigners(e)})).catch((function(e){t.$message.error("Open Report error:"+e)}))},onTableCommand:function(e){var t=null;switch(e){case"ICL":t=this.designService.InsertColumn(!0);break;case"ICR":t=this.designService.InsertColumn(!1);break;case"DC":t=this.designService.DeleteColumn();break;default:break}t&&this.$message.error(t)},onDeleteSelection:function(){this.designService.DeleteSelection()},save:function(){console.log(this.designService.RootDesigner.XmlNode.ownerDocument);var e=this.target,t=[e.Type,e.ID,this.designService.GetXmlString()],n=this;$runtime.channel.invoke("sys.DesignService.SaveModel",t).then((function(e){n.$message.success("Save Report succeed.")})).catch((function(e){n.$message.error("Save error: "+e)}))}}},_=B,I=(n("dbf6"),n("2877")),R=Object(I["a"])(_,i,r,!1,null,"8d3037ca",null);t["default"]=R.exports},f81c:function(e,t,n){}}]);